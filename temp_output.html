<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Sistema de Gestión ETC Pedro García Leal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#D4AF37', // Yellow
                        secondary: '#8B4513', // Brown
                        accent: '#F4E4BC', // Light yellow
                        dark: '#654321', // Dark brown
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease-out',
                        'slide-in-left': 'slideInLeft 0.5s ease-out',
                        'bounce-in': 'bounceIn 0.8s ease-out',
                        'pulse-slow': 'pulse 3s infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideInLeft: {
                            '0%': { opacity: '0', transform: 'translateX(-30px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' },
                        },
                        bounceIn: {
                            '0%': { opacity: '0', transform: 'scale(0.3)' },
                            '50%': { opacity: '1', transform: 'scale(1.05)' },
                            '70%': { transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                    },
                }
            }
        }
    </script>
    <link rel="stylesheet" href="/biblioteca/assets/css/style.css">
    <script src="/biblioteca/assets/js/chatbot.js" defer></script>
    <script>console.log('Header template loaded, chatbot.js should be loading...');</script>
</head>
<body class="bg-gradient-to-br from-gray-50 to-accent min-h-screen flex flex-col">
    <header class="bg-gradient-to-r from-primary to-secondary text-white shadow-2xl sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4 animate-slide-in-left">
                    <img src="/biblioteca/logo.png" alt="Logo ETC" class="h-16 w-16 rounded-full border-4 border-white shadow-lg">
                    <div>
                        <h1 class="text-2xl font-bold tracking-wide">Sistema de Gestión</h1>
                        <p class="text-sm opacity-90">ETC Pedro García Leal</p>
                    </div>
                </div>
                <nav class="hidden md:block">
                    <ul class="flex space-x-8">
                                                    <li><a href="/biblioteca/index.php" class="flex items-center space-x-2 hover:text-accent transition duration-300 transform hover:scale-105"><i class="fas fa-home"></i><span>Inicio</span></a></li>
                                                                            <li><a href="/biblioteca/login.php" class="flex items-center space-x-2 bg-white text-primary px-4 py-2 rounded-full hover:bg-accent transition duration-300 transform hover:scale-105 shadow-lg"><i class="fas fa-sign-in-alt"></i><span>Iniciar Sesión</span></a></li>
                                            </ul>
                </nav>
                <button class="md:hidden text-white focus:outline-none" id="menu-toggle">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
            <nav class="md:hidden mt-4 hidden" id="mobile-menu">
                <ul class="flex flex-col space-y-2">
                                            <li><a href="/biblioteca/index.php" class="flex items-center space-x-2 hover:text-accent transition duration-300 py-2"><i class="fas fa-home"></i><span>Inicio</span></a></li>
                                                                <li><a href="/biblioteca/login.php" class="flex items-center space-x-2 bg-white text-primary px-4 py-2 rounded-full hover:bg-accent transition duration-300 shadow-lg"><i class="fas fa-sign-in-alt"></i><span>Iniciar Sesión</span></a></li>
                                    </ul>
            </nav>
        </div>
        <div class="flex-grow">
        </header>

        <!-- Include Chatbot Component -->
        <!-- Chatbot Component for ETC Pedro García Leal -->
<div id="chatbot-container" class="fixed bottom-6 right-6 z-50" style="z-index: 9999;">
<!-- Debug: Chatbot HTML loaded -->
<script>console.log('Chatbot HTML template loaded on page:', window.location.pathname);</script>
    <!-- Chat Button -->
    <div id="chatbot-button" class="w-16 h-16 bg-gradient-to-r from-primary to-secondary rounded-full shadow-2xl cursor-pointer flex items-center justify-center text-white hover:shadow-xl transition-all duration-300 animate-bounce-in border-4 border-white" style="position: fixed; bottom: 24px; right: 24px; z-index: 10000;" onclick="console.log('Chatbot button clicked directly');">
        <i class="fas fa-robot text-4xl"></i>
    </div>

    <!-- Chat Window -->
    <div id="chatbot-window" class="hidden absolute bottom-24 right-0 w-80 h-96 bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col overflow-hidden" style="z-index: 10001; position: fixed;">
        <!-- Chat Header -->
        <div class="bg-gradient-to-r from-primary to-secondary text-white p-4 rounded-t-2xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center overflow-hidden">
                        <img src="/biblioteca/logo.png" alt="Logo" class="h-full w-full object-cover">
                    </div>
                    <div>
                        <h3 class="font-bold text-sm">Asistente Virtual</h3>
                        <p class="text-xs opacity-90">ETC Pedro García Leal</p>
                    </div>
                </div>
                <button id="chatbot-close" class="text-white hover:text-accent transition-colors">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
        </div>

        <!-- Chat Messages -->
        <div id="chatbot-messages" class="flex-1 p-4 overflow-y-auto bg-gray-50">
            <div class="space-y-3" id="chatbot-messages-container">
                <!-- Messages will be added here dynamically -->
            </div>
        </div>

        <!-- Typing Indicator -->
        <div id="typing-indicator" class="hidden px-4 py-2">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-gradient-to-r from-primary to-secondary rounded-full flex items-center justify-center text-white text-xs">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="bg-white rounded-2xl rounded-tl-md px-4 py-2 shadow-sm">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-primary rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-primary rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                        <div class="w-2 h-2 bg-primary rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Input -->
        <div class="p-4 bg-white border-t border-gray-200">
            <div class="flex space-x-2">
                <input
                    type="text"
                    id="chatbot-input"
                    placeholder="Escribe tu pregunta..."
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                    maxlength="500"
                >
                <button
                    id="chatbot-send"
                    class="w-10 h-10 bg-gradient-to-r from-primary to-secondary text-white rounded-full hover:shadow-lg transition-all duration-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled
                >
                    <i class="fas fa-paper-plane text-sm"></i>
                </button>
            </div>
            <p class="text-xs text-gray-500 mt-2 text-center">
                Solo respondo preguntas sobre la ETC y su sistema
            </p>
        </div>
    </div>
</div>

<style>
/* Custom animations for chatbot */
@keyframes bounce-in {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); opacity: 1; }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
}

.animate-bounce-in {
    animation: bounce-in 0.6s ease-out;
}

/* Smooth transitions for chat messages */
#chatbot-messages .space-y-3 > div {
    animation: slide-in-message 0.3s ease-out;
}

@keyframes slide-in-message {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Custom scrollbar for chat messages */
#chatbot-messages::-webkit-scrollbar {
    width: 4px;
}

#chatbot-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 2px;
}

#chatbot-messages::-webkit-scrollbar-thumb {
    background: linear-gradient(45deg, #D4AF37, #8B4513);
    border-radius: 2px;
}

#chatbot-messages::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(45deg, #B8860B, #654321);
}
</style>



<main class="container mx-auto px-6 py-8">
    <h2 class="text-3xl font-bold text-gray-800 mb-6 animate-slide-in-left flex items-center">
        <i class="fas fa-books mr-4 text-primary"></i>
        Biblioteca Virtual
    </h2>

    
    <!-- Library Statistics -->
    <div class="grid md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white p-6 rounded-2xl shadow-xl animate-fade-in-up">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm font-medium">Total Recursos</p>
                    <p class="text-3xl font-bold text-primary">1</p>
                </div>
                <div class="text-4xl text-primary opacity-70">
                    <i class="fas fa-book"></i>
                </div>
            </div>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow-xl animate-fade-in-up" style="animation-delay: 0.1s">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm font-medium">Subidas Recientes</p>
                    <p class="text-3xl font-bold text-green-500">1</p>
                    <p class="text-xs text-gray-500 mt-1">Últimos 30 días</p>
                </div>
                <div class="text-4xl text-green-500 opacity-70">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow-xl animate-fade-in-up" style="animation-delay: 0.2s">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm font-medium">Tipos de Recursos</p>
                    <p class="text-3xl font-bold text-blue-500">1</p>
                    <p class="text-xs text-gray-500 mt-1">Categorías disponibles</p>
                </div>
                <div class="text-4xl text-blue-500 opacity-70">
                    <i class="fas fa-tags"></i>
                </div>
            </div>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow-xl animate-fade-in-up" style="animation-delay: 0.3s">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm font-medium">Más Popular</p>
                    <p class="text-3xl font-bold text-purple-500">Book</p>
                    <p class="text-xs text-gray-500 mt-1">1 recursos</p>
                </div>
                <div class="text-4xl text-purple-500 opacity-70">
                    <i class="fas fa-star"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filters -->
    <div class="bg-white p-6 rounded-2xl shadow-xl mb-8 animate-fade-in-up">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-semibold flex items-center">
                <i class="fas fa-search mr-2 text-primary"></i>
                Buscar Recursos Digitales
            </h3>
            <button onclick="toggleAdvancedSearch()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg transition duration-200 flex items-center">
                <i class="fas fa-sliders-h mr-2"></i>
                Búsqueda Avanzada
            </button>
        </div>

        <form method="GET" class="space-y-6">
            <!-- Basic Search -->
            <div class="grid md:grid-cols-5 gap-4">
                <div class="md:col-span-2">
                    <label for="search" class="block text-sm font-medium text-gray-700 mb-2">Buscar</label>
                    <input type="text" id="search" name="search" value="" placeholder="Título, autor, descripción, asignatura..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition duration-200">
                </div>
                <div>
                    <label for="type" class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                    <select id="type" name="type" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition duration-200">
                        <option value="">Todos los tipos</option>
                                                    <option value="book" >Book</option>
                                            </select>
                </div>
                <div>
                    <label for="subject" class="block text-sm font-medium text-gray-700 mb-2">Asignatura</label>
                    <select id="subject" name="subject" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition duration-200">
                        <option value="">Todas las asignaturas</option>
                                                    <option value="programacion" >programacion</option>
                                            </select>
                </div>
                <div>
                    <label for="sort" class="block text-sm font-medium text-gray-700 mb-2">Ordenar por</label>
                    <select id="sort" name="sort" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition duration-200">
                        <option value="recent" selected>Más recientes</option>
                        <option value="oldest" >Más antiguos</option>
                        <option value="title" >Título A-Z</option>
                        <option value="author" >Autor A-Z</option>
                        <option value="type" >Tipo</option>
                    </select>
                </div>
            </div>

            <!-- Advanced Search (Hidden by default) -->
            <div id="advanced-search" class="hidden border-t pt-6">
                <h4 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-filter mr-2 text-primary"></i>
                    Filtros Avanzados
                </h4>
                <div class="grid md:grid-cols-3 gap-4">
                    <div>
                        <label for="author" class="block text-sm font-medium text-gray-700 mb-2">Autor específico</label>
                        <input type="text" id="author" name="author" value="" placeholder="Nombre del autor" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition duration-200">
                    </div>
                    <div>
                        <label for="date_from" class="block text-sm font-medium text-gray-700 mb-2">Fecha desde</label>
                        <input type="date" id="date_from" name="date_from" value="" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition duration-200">
                    </div>
                    <div>
                        <label for="date_to" class="block text-sm font-medium text-gray-700 mb-2">Fecha hasta</label>
                        <input type="date" id="date_to" name="date_to" value="" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition duration-200">
                    </div>
                </div>
                <input type="hidden" name="advanced" value="1">
            </div>

            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-600">
                    <span>1 recursos encontrados</span>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="bg-gradient-to-r from-primary to-secondary text-white font-bold py-3 px-6 rounded-lg hover:shadow-lg transition duration-300 transform hover:scale-105 flex items-center">
                        <i class="fas fa-search mr-2"></i>
                        Buscar
                    </button>
                    <a href="index.php" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center">
                        <i class="fas fa-times mr-2"></i>
                        Limpiar
                    </a>
                </div>
            </div>
        </form>
    </div>

    <!-- Resources Grid -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-2xl shadow-xl card-hover animate-fade-in-up">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <h4 class="text-lg font-bold text-gray-800 mb-2 line-clamp-2">prueba</h4>
                            <div class="flex items-center text-sm text-gray-600 mb-2">
                                <i class="fas fa-user mr-1"></i>
                                <span>prueba</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600 mb-2">
                                <i class="fas fa-tag mr-1"></i>
                                <span>Book</span>
                            </div>
                                                            <div class="flex items-center text-sm text-gray-600 mb-3">
                                    <i class="fas fa-graduation-cap mr-1"></i>
                                    <span>programacion</span>
                                </div>
                                                    </div>
                        <div class="ml-3">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                bg-blue-100 text-blue-800">
                                <i class="fas fa-book mr-1"></i>
                                Book                            </span>
                        </div>
                    </div>

                                            <p class="text-gray-600 text-sm mb-4 line-clamp-3">prueba</p>
                    
                    <div class="flex items-center justify-between text-xs text-gray-500 mb-4">
                        <span>
                            <i class="fas fa-calendar mr-1"></i>
                            07/11/2025                        </span>
                                                    <span>
                                <i class="fas fa-user mr-1"></i>
                                Administrador                            </span>
                                            </div>

                    <div class="flex space-x-2">
                        
                                                    <a href="download.php?id=5" class="flex-1 bg-gradient-to-r from-primary to-secondary text-white font-bold py-2 px-4 rounded-lg hover:shadow-lg transition duration-300 transform hover:scale-105 flex items-center justify-center" onclick="console.log('Download attempted for resource ID: 5, file: uploads/library/1762488639_certificado curso python.pdf')">
                                <i class="fas fa-download mr-2"></i>
                                <span>Descargar</span>
                            </a>
                        
                        <button onclick="showResourceDetails(5)" class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-3 rounded-lg transition duration-300" title="Ver detalles">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                </div>
                    </div>

        <!-- Pagination (if needed in future) -->
        <div class="text-center">
            <p class="text-gray-600">Mostrando 1 recursos</p>
        </div>
    </main>

    </div>
    <footer class="bg-gradient-to-r from-dark to-secondary text-white py-12 mt-8 relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-10"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="grid md:grid-cols-4 gap-8">
                <div class="animate-fade-in-up">
                    <h3 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-school mr-2"></i>ETC Pedro García Leal</h3>
                    <p class="text-accent">Excelencia educativa y formación técnica para el futuro.</p>
                </div>
                <div class="animate-fade-in-up" style="animation-delay: 0.2s">
                    <h4 class="text-lg font-semibold mb-4 flex items-center"><i class="fas fa-link mr-2"></i>Enlaces Rápidos</h4>
                    <ul class="space-y-2">
                        <li><a href="/biblioteca/index.php" class="hover:text-primary transition duration-300 flex items-center"><i class="fas fa-home mr-2"></i>Inicio</a></li>
                        <li><a href="/biblioteca/modules/library/index.php" class="hover:text-primary transition duration-300 flex items-center"><i class="fas fa-book mr-2"></i>Biblioteca</a></li>
                        <li><a href="/biblioteca/modules/schedules/view.php" class="hover:text-primary transition duration-300 flex items-center"><i class="fas fa-calendar mr-2"></i>Horarios</a></li>
                                                    <li><a href="/biblioteca/login.php" class="hover:text-primary transition duration-300 flex items-center"><i class="fas fa-sign-in-alt mr-2"></i>Iniciar Sesión</a></li>
                                            </ul>
                </div>
                <div class="animate-fade-in-up" style="animation-delay: 0.4s">
                    <h4 class="text-lg font-semibold mb-4 flex items-center"><i class="fas fa-phone mr-2"></i>Contacto</h4>
                    <ul class="space-y-2">
                        <li class="flex items-center"><i class="fas fa-map-marker-alt mr-2"></i>Dirección: Calle Principal, Ciudad</li>
                        <li class="flex items-center"><i class="fas fa-phone mr-2"></i>Teléfono: (123) 456-7890</li>
                        <li class="flex items-center"><i class="fas fa-envelope mr-2"></i>Email: info@etc.edu</li>
                    </ul>
                </div>
                <div class="animate-fade-in-up" style="animation-delay: 0.6s">
                    <h4 class="text-lg font-semibold mb-4 flex items-center"><i class="fas fa-info-circle mr-2"></i>Acerca de</h4>
                    <p class="text-accent text-sm">Sistema integral de gestión académica y administrativa para estudiantes, docentes y personal de la institución.</p>
                    <div class="flex space-x-4 mt-4">
                        <a href="#" class="text-2xl hover:text-primary transition duration-300"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-2xl hover:text-primary transition duration-300"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-2xl hover:text-primary transition duration-300"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-accent mt-8 pt-8 text-center">
                <p class="text-accent">&copy; 2025 Escuela Técnica Comercial "Pedro García Leal". Todos los derechos reservados. Desarrollado con <i class="fas fa-heart text-red-400"></i> para la educación.</p>
            </div>
        </div>
    </footer>
    <script src="/biblioteca/assets/js/main.js"></script>
    <script>
        // Mobile menu toggle
        document.getElementById('menu-toggle').addEventListener('click', function() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });
    </script>
</body>
</html><script>
function toggleAdvancedSearch() {
    const advancedSearch = document.getElementById('advanced-search');
    const button = event.target.closest('button');

    if (advancedSearch.classList.contains('hidden')) {
        advancedSearch.classList.remove('hidden');
        button.innerHTML = '<i class="fas fa-times mr-2"></i>Ocultar Avanzada';
        button.classList.remove('bg-gray-100', 'hover:bg-gray-200');
        button.classList.add('bg-primary', 'hover:bg-yellow-600', 'text-white');
    } else {
        advancedSearch.classList.add('hidden');
        button.innerHTML = '<i class="fas fa-sliders-h mr-2"></i>Búsqueda Avanzada';
        button.classList.remove('bg-primary', 'hover:bg-yellow-600', 'text-white');
        button.classList.add('bg-gray-100', 'hover:bg-gray-200');
    }
}

function showResourceDetails(resourceId) {
    console.log('showResourceDetails called with resourceId:', resourceId);

    const modal = document.getElementById('resource-modal');
    const loading = document.getElementById('modal-loading');
    const details = document.getElementById('resource-details');
    const error = document.getElementById('modal-error');

    console.log('Modal elements found:', { modal: !!modal, loading: !!loading, details: !!details, error: !!error });

    if (!modal) {
        console.error('Modal element not found!');
        return;
    }

    // Show modal and loading state
    modal.style.display = 'flex';
    if (loading) loading.classList.remove('hidden');
    if (details) details.classList.add('hidden');
    if (error) error.classList.add('hidden');

    console.log('Modal shown, starting fetch request to:', `../../api/library.php?id=${resourceId}`);

    // Fetch resource details
    fetch(`../../api/library.php?id=${resourceId}`)
        .then(response => {
            console.log('Fetch response received:', response);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('API response data:', data);
            if (data.error) {
                throw new Error(data.error);
            }

            // Populate modal with data
            const titleEl = document.getElementById('modal-title');
            const authorEl = document.getElementById('modal-author');
            const typeEl = document.getElementById('modal-type');
            const subjectEl = document.getElementById('modal-subject');
            const uploadDateEl = document.getElementById('modal-upload-date');
            const uploaderEl = document.getElementById('modal-uploader');
            const filePathEl = document.getElementById('modal-file-path');
            const descriptionEl = document.getElementById('modal-description');

            if (titleEl) titleEl.textContent = data.title || 'N/A';
            if (authorEl) authorEl.textContent = data.author || 'N/A';
            if (typeEl) typeEl.textContent = data.type ? data.type.charAt(0).toUpperCase() + data.type.slice(1) : 'N/A';
            if (subjectEl) subjectEl.textContent = data.subject || 'N/A';
            if (uploadDateEl) uploadDateEl.textContent = data.upload_date ? new Date(data.upload_date).toLocaleDateString('es-ES') : 'N/A';
            if (uploaderEl) uploaderEl.textContent = data.uploader_name || 'N/A';
            if (filePathEl) filePathEl.textContent = data.file_path || 'No disponible';
            if (descriptionEl) descriptionEl.textContent = data.description || 'Sin descripción';

            // Set type icon
            const typeIcon = document.getElementById('modal-type-icon');
            if (typeIcon) {
                let iconClass = 'fas fa-file';
                switch(data.type) {
                    case 'book': iconClass = 'fas fa-book'; break;
                    case 'article': iconClass = 'fas fa-file-alt'; break;
                    case 'video': iconClass = 'fas fa-video'; break;
                    case 'document': iconClass = 'fas fa-file-pdf'; break;
                }
                typeIcon.className = iconClass + ' text-primary';
            }

            // Handle download button
            const downloadBtn = document.getElementById('modal-download-btn');
            if (downloadBtn) {
                if (data.file_path) {
                    downloadBtn.href = `download.php?id=${data.id}`;
                    downloadBtn.classList.remove('hidden');
                } else {
                    downloadBtn.classList.add('hidden');
                }
            }

            // Show details, hide loading
            if (loading) loading.classList.add('hidden');
            if (details) details.classList.remove('hidden');
            console.log('Modal populated and shown successfully');
        })
        .catch(error => {
            console.error('Error fetching resource details:', error);
            if (loading) loading.classList.add('hidden');
            if (error) error.classList.remove('hidden');
        });
}

function closeResourceModal() {
    const modal = document.getElementById('resource-modal');
    if (modal) {
        modal.style.display = 'none';
    }
}

// Close modal when clicking outside
document.getElementById('resource-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeResourceModal();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modal = document.getElementById('resource-modal');
        if (!modal.classList.contains('hidden')) {
            closeResourceModal();
        }
    }
});

function downloadResource(resourceId, filePath) {
    // Create a temporary link to download the file
    const link = document.createElement('a');
    link.href = '/biblioteca/' + filePath;
    link.download = filePath.split('/').pop(); // Get filename from path
    link.target = '_blank';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    // Optional: Show success message
    console.log('Download initiated for resource ID: ' + resourceId + ', filePath: ' + filePath);
}

function loanResource(resourceId) {
    if (confirm('¿Está seguro de que desea pedir prestado este recurso? Tendrá 7 días para devolverlo.')) {
        fetch('loans.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'action=loan&resource_id=' + resourceId
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Préstamo solicitado exitosamente. Fecha de devolución: ' + data.due_date);
                // Redirect to prevent form resubmission
                window.location.href = 'index.php?success=loan';
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al procesar la solicitud');
        });
    }
}

function returnLoan(loanId) {
    if (confirm('¿Está seguro de que desea devolver este recurso?')) {
        fetch('loans.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'action=return&loan_id=' + loanId
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Recurso devuelto exitosamente.');
                // Redirect to prevent form resubmission
                window.location.href = 'index.php?success=return';
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al procesar la solicitud');
        });
    }
}
</script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-clamp: 2;
}

.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-clamp: 3;
}
</style>